<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<style>

.chart rect {
  fill: steelblue;
}

.chart rect.males{
  fill: lightblue;
}


.chart rect.females{
  fill: white;
}

.chart text {
  fill: black;
  font: 10px sans-serif;
  text-anchor: end;
}

section {
    width:48%;
    float:left;
}

</style>
</head>
<body>
<h1>Population Histograms</h1>
<div>
    <label for="year1">Year 1</label> <input type="number" id="year1" value="1960" min="1950" max="2015"/> 
    <label for="year2">Year 2</label> <input type="number" id="year2" value="2010" min="1950" max="2015" /> 
    <label for="country1">Country 1</label> <input type="text" id="country1" value="Brazil" list="countries" />
    <label for="country2">Country 2</label> <input type="text" id="country2" value="China" list="countries" /><br>
    <label for="groupLen">Group into</label> <input type="number" id="groupLen" value="10"  min="1" max="10" length="3"/> year bands
    <button onClick="draw()">Draw</button>
</div>

<datalist id="countries">
		<option value="Afghanistan" />
   	<option value="Albania" />
   	<option value="Algeria" />
   	<option value="Angola" />
   	<option value="Antigua and Barbuda" />
   	<option value="Azerbaijan" />
   	<option value="Argentina" />
   	<option value="Australia" />
   	<option value="Austria" />
   	<option value="The Bahamas" />
   	<option value="Bahrain" />
   	<option value="Bangladesh" />
   	<option value="Armenia" />
   	<option value="Barbados" />
   	<option value="Belgium" />
   	<option value="Bhutan" />
   	<option value="Bolivia" />
   	<option value="Bosnia and Herzegovina" />
   	<option value="Botswana" />
   	<option value="Brazil" />
   	<option value="Belize" />
   	<option value="Solomon Islands" />
   	<option value="Brunei Darussalam" />
   	<option value="Bulgaria" />
   	<option value="Myanmar" />
   	<option value="Burundi" />
   	<option value="Belarus" />
   	<option value="Cambodia" />
   	<option value="Cameroon" />
   	<option value="Canada" />
   	<option value="Cabo Verde" />
   	<option value="Central African Republic" />
   	<option value="Sri Lanka" />
   	<option value="Chad" />
   	<option value="Chile" />
   	<option value="China" />
   	<option value="Colombia" />
   	<option value="Comoros" />
   	<option value="Mayotte" />
   	<option value="Congo" />
   	<option value="Dem Rep of Congo" />
   	<option value="Costa Rica" />
   	<option value="Croatia" />
   	<option value="Cuba" />
   	<option value="Cyprus" />
   	<option value="Czech Republic" />
   	<option value="Benin" />
   	<option value="Denmark" />
   	<option value="Dominican Republic" />
   	<option value="Ecuador" />
   	<option value="El Salvador" />
   	<option value="Equatorial Guinea" />
   	<option value="Ethiopia" />
   	<option value="Eritrea" />
   	<option value="Estonia" />
   	<option value="Fiji" />
   	<option value="Finland" />
   	<option value="France" />
   	<option value="French Guiana" />
   	<option value="French Polynesia" />
   	<option value="Djibouti" />
   	<option value="Gabon" />
   	<option value="Georgia" />
   	<option value="The Gambia" />
   	<option value="West Bank and Gaza" />
   	<option value="Germany" />
   	<option value="Ghana" />
   	<option value="Kiribati" />
   	<option value="Greece" />
   	<option value="Grenada" />
   	<option value="Guadeloupe" />
   	<option value="Guam" />
   	<option value="Guatemala" />
   	<option value="Guinea" />
   	<option value="Guyana" />
   	<option value="Haiti" />
   	<option value="Honduras" />
   	<option value="Hong Kong SAR-China" />
   	<option value="Hungary" />
   	<option value="Iceland" />
   	<option value="India" />
   	<option value="Indonesia" />
   	<option value="Islamic Republic of Iran" />
   	<option value="Iraq" />
   	<option value="Ireland" />
   	<option value="Israel" />
   	<option value="Italy" />
   	<option value="Cote-d-Ivoire" />
   	<option value="Jamaica" />
   	<option value="Japan" />
   	<option value="Kazakhstan" />
   	<option value="Jordan" />
   	<option value="Kenya" />
   	<option value="Dem Peoples Rep of Korea" />
   	<option value="Rep of Korea" />
   	<option value="Kuwait" />
   	<option value="Kyrgyz Republic" />
   	<option value="Lao PDR" />
   	<option value="Lebanon" />
   	<option value="Lesotho" />
   	<option value="Latvia" />
   	<option value="Liberia" />
   	<option value="Libya" />
   	<option value="Lithuania" />
   	<option value="Luxembourg" />
   	<option value="Macao SAR China" />
   	<option value="Madagascar" />
   	<option value="Malawi" />
   	<option value="Malaysia" />
   	<option value="Maldives" />
   	<option value="Mali" />
   	<option value="Malta" />
   	<option value="Martinique" />
   	<option value="Mauritania" />
   	<option value="Mauritius" />
   	<option value="Mexico" />
   	<option value="Mongolia" />
   	<option value="Moldova" />
   	<option value="Montenegro" />
   	<option value="Morocco" />
   	<option value="Mozambique" />
   	<option value="Oman" />
   	<option value="Namibia" />
   	<option value="Nepal" />
   	<option value="The Netherlands" />
   	<option value="Curacao" />
   	<option value="Aruba" />
   	<option value="New Caledonia" />
   	<option value="Vanuatu" />
   	<option value="New Zealand" />
   	<option value="Nicaragua" />
   	<option value="Niger" />
   	<option value="Nigeria" />
   	<option value="Norway" />
   	<option value="Federated States of Micronesia" />
   	<option value="Pakistan" />
   	<option value="Panama" />
   	<option value="Papua New Guinea" />
   	<option value="Paraguay" />
   	<option value="Peru" />
   	<option value="Philippines" />
   	<option value="Poland" />
   	<option value="Portugal" />
   	<option value="Guinea-Bissau" />
   	<option value="Timor-Leste" />
   	<option value="Puerto Rico" />
   	<option value="Qatar" />
   	<option value="Reunion" />
   	<option value="Romania" />
   	<option value="Russian Federation" />
   	<option value="Rwanda" />
   	<option value="St-Lucia" />
   	<option value="St-Vincent and the Grenadines" />
   	<option value="Sao Tome and Principe" />
   	<option value="Saudi Arabia" />
   	<option value="Senegal" />
   	<option value="Serbia" />
   	<option value="Seychelles" />
   	<option value="Sierra Leone" />
   	<option value="Singapore" />
   	<option value="Slovak Republic" />
   	<option value="Vietnam" />
   	<option value="Slovenia" />
   	<option value="Somalia" />
   	<option value="South Africa" />
   	<option value="Zimbabwe" />
   	<option value="Spain" />
   	<option value="South Sudan" />
   	<option value="Sudan" />
   	<option value="Western Sahara" />
   	<option value="Suriname" />
   	<option value="Swaziland" />
   	<option value="Sweden" />
   	<option value="Switzerland" />
   	<option value="Syrian Arab Rep" />
   	<option value="Tajikistan" />
   	<option value="Thailand" />
   	<option value="Togo" />
   	<option value="Tonga" />
   	<option value="Trinidad and Tobago" />
   	<option value="United Arab Emirates" />
   	<option value="Tunisia" />
   	<option value="Turkey" />
   	<option value="Turkmenistan" />
   	<option value="Uganda" />
   	<option value="Ukraine" />
   	<option value="FYR Macedonia" />
   	<option value="Arab Rep of Egypt" />
   	<option value="United Kingdom" />
   	<option value="Channel Islands" />
   	<option value="Tanzania" />
   	<option value="United States" />
   	<option value="US Virgin Islands" />
   	<option value="Burkina Faso" />
   	<option value="Uruguay" />
   	<option value="Uzbekistan" />
   	<option value="RB-de-Venezuela" />
   	<option value="Samoa" />
   	<option value="Rep of Yemen" />
   	<option value="Zambia" />
   	<option value="World" />
</datalist>

<section>
    <h2 id="label-0-0">Brazil 1980 - Millions</h2>
    <svg class="chart" id="chart-0-0"></svg>
</section>

<section>
    <h2 id="label-0-1" >Brazil 2000 - Millions</h2>
    <svg class="chart" id="chart-0-1"></svg>
</section>

<section>
    <h2 id="label-1-0">China 1980 - Millions</h2>
    <svg class="chart" id="chart-1-0"></svg>
</section>

<section>
    <h2 id="label-1-1">China 2000 - Millions</h2>
    <svg class="chart" id="chart-1-1"></svg>
</section>


<section>
<p> The charts are made in the page by using <a href="http://d3js.org" target="_blank" >D3.js</a> (<a href="http://bost.ocks.org/mike/bar/3/">example</a>) </p>
<p> The data is from <a href="http://population.io/"  target="_blank" >http://population.io/</a>. 
The data is availble for all countries. <a href="http://api.population.io/#!/population/retrievePopulationTableAllAges" target="_blank">API docs for the calls used</a></p>
</section>



<script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.5/d3.min.js"></script>


<script>

var proccessYear = function(json) {
  var data = [];
  json.forEach(function(year){
      var group = Math.floor(year.age /groupLength);
      if(!data[group]) {
        data[group] = year;
        data[group].label = ""+(group *groupLength)+"-"+(((group+1) *groupLength)-1);  
      } else {
        data[group].total += year.total;
        data[group].males += year.males;
        data[group].females += year.females;
      }
    
    });
  return data;
};

var groupLength = 10;

var aYears = [1980, 2010];
var aCountries = ["Brazil", "China"];


function visualizeit(sSelector, data) {
    
    var width = 420,
        barHeight = 20;
    
    
    var male_x = d3.scale.linear()
        .range([width / 2 , width]);
        
    var female_x = d3.scale.linear()
        .range([width / 2 , 0]);
    
        
    var chart = d3.select(sSelector)
        .attr("width", width);
        
      male_x.domain([0, d3.max(data, function(d) { return Math.max(d.males, d.females); })]);
      female_x.domain([0, d3.max(data, function(d) { return Math.max(d.males, d.females); })]);
    
      
      chart.attr("height", barHeight * data.length);
    
      var bar = chart.selectAll("g")
          .data(data)
        .enter().append("g")
          .attr("transform", function(d, i) { return "translate(0," + (data.length - 1 - i ) * barHeight + ")"; });
  
      bar.append("rect")
          //.attr("x",  width/2)
          .attr("width", function(d) { return male_x(d.males); })
          .attr("height", barHeight - 1)
          .attr("class", "males");
    

      bar.append("rect")
          //.attr("x", function(d) { return x( -1 * d.females); })
          .attr("width", function(d) { return female_x( d.females); })
          .attr("height", barHeight)
          .attr("class", "females");
      
          
          
      
      bar.append("text")
          .attr("x", function(d) { return male_x(d.males) - 3; })
          .attr("y", barHeight / 2)
          .attr("dy", ".35em")
          .text(function(d) { return Math.round(d.males/100000)/10; });
          
      bar.append("text")
          .attr("x", function(d) { return female_x(d.females) + 20; })
          .attr("y", barHeight / 2)
          .attr("dy", ".35em")
          .text(function(d) { return Math.round(d.females/100000)/10; });

      
      bar.append("text")
          .attr("x", width/2)
          .attr("y", barHeight / 2)
          .attr("dy", ".35em")
          .text(function(d) { return d.label  });

  
}

function draw() {
    groupLength = document.getElementById("groupLen").value;
    //console.log("groupLength =", groupLength);
    
    var aYears = [document.getElementById("year1").value, document.getElementById("year2").value];
    //console.log("aYears =", aYears);
    var aCountries = [document.getElementById("country1").value, document.getElementById("country2").value];
    //console.log("aCountries =", aCountries);
    

    for(var i = 0; i < aCountries.length; i++) {
        for(var j = 0; j < aYears.length; j++) {
    
            var sURL = "http://api.population.io:80/1.0/population/"+aYears[j]+"/"+aCountries[i]+"/";
            var sLabel = aCountries[i]+" "+ aYears[j];
            var sLabelID = "label-"+i+"-"+j;
            var ele = document.getElementById(sLabelID);
            ele.innerHTML = sLabel;
            
            d3.json(sURL, function(iY, iC, error, json) {
                if (error) {
                    return //console.warn(error);
                }
                
                var data = proccessYear(json);
                var sChartID = "chart-"+iC+"-"+iY;
                document.getElementById(sChartID).innerHTML = "";
                visualizeit("#"+sChartID, data);
            }.bind(this, j, i));
        }
    }
}

draw();

function type(d) {
  d.total = +d.total; // coerce to number
  return d;
}

</script>


</body>
</html>

