<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<style>

.chart rect {
  fill: steelblue;
}

.chart text {
  fill: white;
  font: 10px sans-serif;
  text-anchor: end;
}

section {
    width:48%;
    float:left;
}

</style>
<script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.5/d3.min.js"></script>


<script>

//var proccessYear = ;

var sURL = "http://api.population.io:80/1.0/population/1980/Brazil/";

d3.json(sURL, function(error, json) {
  if (error) return console.warn(error);
  
  var data = [];
  var groupLength = 5;
  json.forEach(function(year){
  var group = Math.floor(year.age /groupLength);
  if(!data[group]) {
    data[group] = year;
    data[group].label = ""+(group *groupLength)+"-"+(((group+1) *groupLength)-1);  
  } else {
    data[group].total += year.total;
    data[group].total += year.total;
    data[group].females += year.females;
  }

});
  //console.log("data =", data);
  visualizeit("#chart1", data);
});

var sURL2 = "http://api.population.io:80/1.0/population/2000/Brazil/";

d3.json(sURL2, function(error, json) {
  if (error) return console.warn(error);
  
  var data = [];
  var groupLength = 5;
  json.forEach(function(year){
  var group = Math.floor(year.age /groupLength);
  if(!data[group]) {
    data[group] = year;
    data[group].label = ""+(group *groupLength)+"-"+(((group+1) *groupLength)-1);  
  } else {
    data[group].total += year.total;
    data[group].total += year.total;
    data[group].females += year.females;
  }

});
  //console.log("data =", data);
  visualizeit("#chart2", data);
});


var sURL3 = "http://api.population.io:80/1.0/population/1980/China/";

d3.json(sURL3, function(error, json) {
  if (error) return console.warn(error);
  
  var data = [];
  var groupLength = 5;
  json.forEach(function(year){
  var group = Math.floor(year.age /groupLength);
  if(!data[group]) {
    data[group] = year;
    data[group].label = ""+(group *groupLength)+"-"+(((group+1) *groupLength)-1);  
  } else {
    data[group].total += year.total;
    data[group].total += year.total;
    data[group].females += year.females;
  }

});
  //console.log("data =", data);
  visualizeit("#chart3", data);
});

var sURL4 = "http://api.population.io:80/1.0/population/2000/China/";

d3.json(sURL4, function(error, json) {
  if (error) return console.warn(error);
  
  var data = [];
  var groupLength = 5;
  json.forEach(function(year){
  var group = Math.floor(year.age /groupLength);
  if(!data[group]) {
    data[group] = year;
    data[group].label = ""+(group *groupLength)+"-"+(((group+1) *groupLength)-1);  
  } else {
    data[group].total += year.total;
    data[group].total += year.total;
    data[group].females += year.females;
  }

});
  //console.log("data =", data);
  visualizeit("#chart4", data);
});




function visualizeit(sSelector, data) {
    
    var width = 420,
        barHeight = 20;
    
    var x = d3.scale.linear()
        .range([0, width]);
    
    var chart = d3.select(sSelector)
        .attr("width", width);
    
    
      x.domain([0, d3.max(data, function(d) { return d.total; })]);
    
      chart.attr("height", barHeight * data.length);
    
      var bar = chart.selectAll("g")
          .data(data)
        .enter().append("g")
          .attr("transform", function(d, i) { return "translate(0," + (data.length - 1 - i ) * barHeight + ")"; });
    
      bar.append("rect")
          .attr("width", function(d) { return x(d.total); })
          .attr("height", barHeight - 1);
    
      bar.append("text")
          .attr("x", function(d) { return x(d.total) - 3; })
          .attr("y", barHeight / 2)
          .attr("dy", ".35em")
          .text(function(d) { return d.label +" "+ Math.round(d.total/100000)/10; });

          
}

function type(d) {
  d.total = +d.total; // coerce to number
  return d;
}

</script>
</head>
<body>
<h1>Proof of Concept Population Histogram</h1>

<section>
<h2>Brazil 1980 - Millions</h2>
<svg class="chart" id="chart1"></svg>

</section>

<section>
<h2>Brazil 2000 - Millions</h2>
<svg class="chart" id="chart2"></svg>
</section>

<section>
<h2>China 1980 - Millions</h2>
<svg class="chart" id="chart3"></svg>

</section>

<section>
<h2>China 2000 - Millions</h2>
<svg class="chart" id="chart4"></svg>
</section>


<section>
<p>
This took me about an hour but I'd not touched the chart library or data before</p>
<p> The chart is made in the page by using <a href="http://d3js.org" target="_blank" >D3.js</a> (<a href="http://bost.ocks.org/mike/bar/3/">example</a>) </p>
<p> The data is from <a href="http://population.io/"  target="_blank" >http://population.io/</a>. 
The data is availble for all countries and many years (and does have a male /
female split for a proper population pyramid but i couldn't make that work on my first go). <a href="http://api.population.io/#!/population/retrievePopulationTableAllAges" target="_blank">API docs for the call i used</a></p>
</section>
</body>
</html>

